name: Adjust Issue Title

on:
  issues:
    types: [opened, edited]

permissions:
  issues: write
  contents: read

jobs:
  # Job for bug reports with resource_pack + resource_pack_version
  process-bug-report:
    runs-on: ubuntu-latest
    if: contains(github.event.issue.title, '[Bug -')
    steps:
      - name: Update bug report title
        uses: actions/github-script@v7
        with:
          script: |
            const body = context.payload. issue.body || '';
            let title = context.payload.issue. title || '';
            
            if (!title.includes('{{')) {
              console.log('No placeholders in title');
              return;
            }
            
            // Extract resource pack
            const packMatch = body.match(/### Resource pack\s*\n\s*(.+)/i);
            if (packMatch && packMatch[1]) {
              const pack = packMatch[1].trim();
              title = title.replace('{{resource_pack}}', pack);
              console.log('Replaced resource_pack with:', pack);
            }
            
            // Extract resource pack version
            const versionMatch = body.match(/### Resource pack version\s*\n\s*(.+)/i);
            if (versionMatch && versionMatch[1]) {
              const version = versionMatch[1].trim();
              title = title.replace('{{resource_pack_version}}', version);
              console.log('Replaced resource_pack_version with:', version);
            }
            
            if (title !== context.payload.issue. title) {
              await github. rest.issues.update({
                owner: context.repo.owner,
                repo: context.repo. repo,
                issue_number:  context.payload.issue.number,
                title: title
              });
              console.log('Updated title to:', title);
            }

  # Job for addition/update requests with resource_pack only
  process-resource-pack:
    runs-on: ubuntu-latest
    if:  contains(github.event.issue. title, '[Addition -') || contains(github.event.issue.title, '[Update -')
    steps:
      - name:  Update resource pack title
        uses: actions/github-script@v7
        with: 
          script: |
            const body = context.payload.issue. body || '';
            let title = context.payload.issue.title || '';
            
            if (!title.includes('{{resource_pack}}')) {
              console.log('No resource_pack placeholder');
              return;
            }
            
            const match = body.match(/### Resource pack\s*\n\s*(.+)/i);
            if (match && match[1]) {
              const pack = match[1].trim();
              title = title.replace('{{resource_pack}}', pack);
              
              await github.rest.issues.update({
                owner: context.repo. owner,
                repo: context. repo.repo,
                issue_number: context.payload.issue. number,
                title: title
              });
              console.log('Updated title to:', title);
            }

  # Job for new pack requests with pack_name
  process-new-pack:
    runs-on: ubuntu-latest
    if:  contains(github.event.issue. title, '[New]')
    steps:
      - name: Update new pack title
        uses: actions/github-script@v7
        with:
          script: |
            const body = context.payload.issue.body || '';
            let title = context.payload.issue.title || '';
            
            if (!title.includes('{{pack_name}}')) {
              console.log('No pack_name placeholder');
              return;
            }
            
            const match = body.match(/### Resource pack name\s*\n\s*(. +)/i);
            if (match && match[1]) {
              const packName = match[1].trim();
              title = title.replace('{{pack_name}}', packName);
              
              await github. rest.issues.update({
                owner: context.repo.owner,
                repo: context.repo. repo,
                issue_number:  context.payload.issue.number,
                title: title
              });
              console.log('Updated title to:', title);
            }